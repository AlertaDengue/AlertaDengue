

{% load lookup %}
{% load lookup %}

{% load hashthis %}

<!-- Start Component -->
{% block regional_collapse_component %}

<div id="accordion">

  {% for key,value in regional_by_state.items %}

    <div class="card">

      <div id="flip_{{ key }}" class="collapse-style">
          <button
            class="collapse-effect text-left"
            data-toggle="collapse"
            data-target="#panel_{{ key | unquote_str }}"
            aria-expanded="true"
            aria-controls="panel_{{ key | unquote_str }}"

          >
            <span>{{ key }}</span>
          </button>
        </h5>
      </div>

      <div id="panel_{{ key | unquote_str }}"
      {% if key == 'Baixada LitorÃ¢nea' %}
          class="collapse show"
          {% else %}
          class="collapse"
          {% endif %}
          aria-labelledby="flip_{{ key }}"
          data-parent="#accordion">
          <div class="card-body">
            <div class="spinner-border text-muted">
            </div>
          </div>
      </div>
    </div>

  {% endfor %}

</div>

{% endblock %}

<script type="text/javascript"> //

  $(document).ready(function(){
    const allRegionals = Object.keys({{ regional_by_state| safe }});
    const state_abbv = "{{ state }}";
    let requestCache = {};

      function loadDataFromApi(apiUrl) {
        if (!requestCache[apiUrl]) {
          requestCache[apiUrl] = $.ajax({
              type: 'GET',
              url: apiUrl,
              dataType: "html"

          });
        }
        return requestCache[apiUrl];
      }
      $.each( allRegionals, function( i, regional_name ) {
        // console.log(encodeURIComponent(regional_name)) ;
        // console.log(regional_name)  TODO: USAR O ID DA REGIONAL
        // const spacesReplaced = decodeURIComponent(regional_name).replaceAll('/', '&');
        const spacesReplaced = regional_name.replaceAll(' ', '_').replaceAll('/', '-');

        // console.log(spacesReplaced)
        loadDataFromApi("/fetchdata/" + state_abbv + "/"  + spacesReplaced)
        .then(function(data) {
          $("#panel_" + spacesReplaced).html(data);
            // console.log(spacesReplaced) ;
          // console.log("State: " + regional_name);
        });
    });
  });

</script>
